<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Depot Mini</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* 1. GRUNDGERÜST: SCHWARZ & WEISS ERZWINGEN */
        body { 
            background-color: #000000 !important; 
            color: #ffffff !important; 
            font-family: -apple-system, sans-serif; 
            font-size: 12px; /* Generell kleinere Schrift */
            padding-bottom: 50px;
        }

        /* 2. HEADER: EXTREM SCHMAL */
        .header-box { 
            background: #111; 
            border-bottom: 1px solid #333;
            padding: 8px 12px; /* Wenig Abstand */
            position: sticky; top: 0; z-index: 100;
        }
        .header-row { display: flex; justify-content: space-between; align-items: center; }
        .total-val { font-size: 18px; font-weight: bold; color: white; }
        .sub-val { font-size: 11px; color: #999; }
        .profit-val { font-size: 12px; font-weight: bold; }

        /* 3. EINGABE: KOMPAKT */
        .input-card { 
            background: #1a1a1a; 
            border-bottom: 1px solid #333; 
            padding: 10px; 
        }
        /* HIER IST DER FIX FÜR DUNKLE SCHRIFT: */
        .form-control, .form-select { 
            background-color: #2a2a2a !important; 
            border: 1px solid #444 !important; 
            color: #ffffff !important; /* Weiß erzwingen */
            -webkit-text-fill-color: #ffffff !important; /* iPhone Fix */
            font-size: 12px !important; 
            height: 30px !important; /* Sehr flach */
            padding: 2px 5px !important;
            border-radius: 4px !important;
        }
        ::placeholder { color: #888 !important; opacity: 1; }
        
        .btn-add { 
            background: #FFD700; color: black; border: none; 
            height: 30px; font-size: 12px; font-weight: bold; 
            width: 100%; border-radius: 4px; 
        }
        
        /* 4. LISTE: SCHMAL */
        .list-item { 
            border-bottom: 1px solid #222; 
            padding: 6px 10px; 
            background: black;
        }
        .item-top { display: flex; justify-content: space-between; font-size: 13px; color: white; }
        .item-sub { display: flex; justify-content: space-between; font-size: 10px; color: #777; margin-top: 1px; }
        
        /* HELFER */
        .c-gold { color: #FFD700; }
        .c-silver { color: #ccc; }
        .p-plus { color: #4cd964; }
        .p-minus { color: #ff3b30; }
        .del-btn { color: #444; font-size: 14px; margin-left: 10px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header-box">
        <div class="header-row">
            <div>
                <span class="total-val" id="totalValue">0 €</span>
                <span class="sub-val" id="totalInvest"> (Invest: 0 €)</span>
            </div>
            <div style="text-align: right;">
                <div id="profitDisplay" class="profit-val">...</div>
                <small onclick="fetchPrices()" style="color:#FFD700; font-size:10px; cursor:pointer;">↻ Update</small>
            </div>
        </div>
    </div>

    <div class="input-card">
        <div class="row g-1"> <div class="col-3">
                <select id="type" class="form-select">
                    <option value="gold">Gold</option>
                    <option value="silver">Silber</option>
                </select>
            </div>
            <div class="col-3">
                <input type="number" id="weight" class="form-control" placeholder="Gramm" inputmode="decimal">
            </div>
            <div class="col-3">
                <input type="number" id="buyPrice" class="form-control" placeholder="Preis €" inputmode="decimal">
            </div>
            <div class="col-3">
                <button onclick="add()" class="btn-add">OK</button>
            </div>
            <div class="col-12 mt-1">
                <input type="text" id="name" class="form-control" placeholder="Beschreibung (z.B. Barren)">
            </div>
        </div>
    </div>

    <div id="list"></div>
    
    <div class="text-center mt-3">
        <span onclick="wipe()" style="font-size:10px; color:#444; text-decoration:underline;">Reset</span>
    </div>

    <script>
        let prices = { gold: 0, silver: 0 };

        async function init() {
            render();
            await fetchPrices();
        }

        async function fetchPrices() {
            const pDisplay = document.getElementById('profitDisplay');
            pDisplay.innerText = "⏳";
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=pax-gold,kinesis-silver&vs_currencies=eur');
                const data = await res.json();
                prices.gold = data['pax-gold'].eur / 31.1035; 
                prices.silver = data['kinesis-silver'].eur / 31.1035;
                render();
            } catch (e) {
                pDisplay.innerText = "Offline";
            }
        }

        function add() {
            let wVal = document.getElementById('weight').value.replace(',', '.');
            let pVal = document.getElementById('buyPrice').value.replace(',', '.');
            const w = parseFloat(wVal);
            const p = parseFloat(pVal);
            const t = document.getElementById('type').value;
            const n = document.getElementById('name').value || (t==='gold'?'Gold':'Silber');

            if (!w || !p) return;

            const items = JSON.parse(localStorage.getItem('db')) || [];
            items.push({ id: Date.now(), t, w, p, n });
            localStorage.setItem('db', JSON.stringify(items));
            
            document.getElementById('weight').value = '';
            document.getElementById('buyPrice').value = '';
            document.getElementById('name').value = '';
            render();
        }

        function render() {
            const items = JSON.parse(localStorage.getItem('db')) || [];
            const list = document.getElementById('list');
            list.innerHTML = '';
            
            let totalVal = 0; 
            let totalInvest = 0;

            items.slice().reverse().forEach(i => {
                const currentP = i.t === 'gold' ? prices.gold : prices.silver;
                let val = (prices.gold > 0) ? (i.w * currentP) : i.p;
                const profit = val - i.p;
                
                totalVal += val;
                totalInvest += i.p;

                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div class="item-top">
                        <span>
                            <span class="${i.t==='gold'?'c-gold':'c-silver'}">●</span> 
                            <b>${i.w}g</b> ${i.name}
                        </span>
                        <span>${prices.gold > 0 ? val.toFixed(2) : '?'} € <span onclick="del(${i.id})" class="del-btn">×</span></span>
                    </div>
                    <div class="item-sub">
                        <span>EK: ${i.p.toFixed(2)} €</span>
                        <span class="${profit>=0?'p-plus':'p-minus'}">
                            ${profit>=0?'+':''}${profit.toFixed(2)} €
                        </span>
                    </div>
                `;
                list.appendChild(div);
            });

            // Formatierung Zahlen
            const fmt = (n) => n.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2});

            document.getElementById('totalValue').innerText = fmt(totalVal) + ' €';
            document.getElementById('totalInvest').innerText = '(EK: ' + fmt(totalInvest) + ')';
            
            const totalProfit = totalVal - totalInvest;
            if(prices.gold > 0) {
                const pElem = document.getElementById('profitDisplay');
                pElem.innerText = (totalProfit>=0?'+':'') + fmt(totalProfit) + ' €';
                pElem.className = "profit-val " + (totalProfit>=0?'p-plus':'p-minus');
            }
        }

        function del(id) {
            if(confirm('Löschen?')) {
                let items = JSON.parse(localStorage.getItem('db')) || [];
                items = items.filter(i => i.id !== id);
                localStorage.setItem('db', JSON.stringify(items));
                render();
            }
        }

        function wipe() {
            if(confirm('Alles löschen?')) { localStorage.clear(); render(); }
        }

        init();
    </script>
</body>
</html>
