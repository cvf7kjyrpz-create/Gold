<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mein Depot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Modernes, dunkles Design */
        body { 
            background-color: #000000; 
            color: #ffffff; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            padding-bottom: 80px; /* Platz unten */
        }

        /* Der Kopfbereich - jetzt kompakter */
        .header-box { 
            background: linear-gradient(180deg, #1c1c1e 0%, #000000 100%);
            border-bottom: 1px solid #333;
            padding: 15px 20px; 
            position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Die Karten f√ºr die Eintr√§ge - schlanker */
        .card { 
            background-color: #1c1c1e; 
            border: 1px solid #2c2c2e; 
            border-radius: 10px; 
            margin-bottom: 8px; /* Weniger Abstand zwischen den Items */
            padding: 10px 15px; /* Weniger Innenabstand */
        }
        
        /* Eingabefelder - feiner */
        .form-control, .form-select { 
            background-color: #2c2c2e !important; 
            border: 1px solid #3a3a3c !important; 
            color: white !important; 
            font-size: 14px;
            height: 38px; /* Flacher */
            border-radius: 6px !important;
        }
        .form-control:focus { box-shadow: none; border-color: #FFD700 !important; }

        /* Der Button */
        .btn-gold { 
            background: linear-gradient(90deg, #FFD700, #FDB931); 
            color: black; 
            font-weight: 600; 
            border-radius: 6px; 
            width: 100%; 
            padding: 8px; 
            border: none; 
            font-size: 15px;
        }

        /* Textfarben */
        .gold-text { color: #FFD700; }
        .silver-text { color: #A0A0A0; }
        .profit-plus { color: #32D74B; font-size: 0.9em; }
        .profit-minus { color: #FF453A; font-size: 0.9em; }
        .small-label { font-size: 11px; text-transform: uppercase; color: #666; letter-spacing: 0.5px; }
        
        /* L√∂schen Icon klein */
        .delete-x { color: #555; font-size: 18px; text-decoration: none; padding: 0 5px; }
    </style>
</head>
<body>

    <div class="header-box">
        <div>
            <div class="small-label">GESAMTDEPOT</div>
            <div id="totalValue" style="font-size: 24px; font-weight: 700; color: white;">0,00 ‚Ç¨</div>
        </div>
        <div class="text-end">
            <div class="small-label">GEWINN/VERLUST</div>
            <div id="profitDisplay" style="font-size: 16px;">...</div>
        </div>
    </div>

    <div class="container mt-3">
        
        <div class="card" style="background: #151515; border-color: #333;">
            <div class="row g-2">
                <div class="col-4">
                    <select id="type" class="form-select">
                        <option value="gold">Gold</option>
                        <option value="silver">Silber</option>
                    </select>
                </div>
                <div class="col-4">
                    <input type="number" id="weight" class="form-control" placeholder="Gramm" inputmode="decimal">
                </div>
                <div class="col-4">
                    <input type="number" id="buyPrice" class="form-control" placeholder="Euro" inputmode="decimal">
                </div>
                <div class="col-9">
                    <input type="text" id="name" class="form-control" placeholder="Beschreibung (optional)">
                </div>
                <div class="col-3">
                    <button onclick="add()" class="btn-gold">OK</button>
                </div>
            </div>
        </div>

        <div class="small-label mt-4 mb-2 ms-1">DEINE WERTE</div>
        <div id="list"></div>
        
        <div class="text-center mt-5">
            <small onclick="wipe()" style="color: #444; cursor:pointer;">Liste leeren</small>
        </div>
    </div>

    <script>
        let prices = { gold: 0, silver: 0 };

        async function init() {
            render();
            try {
                // Preise live holen
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=pax-gold,kinesis-silver&vs_currencies=eur');
                const data = await res.json();
                prices.gold = data['pax-gold'].eur / 31.1035; 
                prices.silver = data['kinesis-silver'].eur / 31.1035;
                render();
            } catch (e) {
                // Fehler ignorieren, alte Preise nutzen falls vorhanden
            }
        }

        function add() {
            // Kommas durch Punkte ersetzen f√ºr das iPhone
            const wStr = document.getElementById('weight').value.replace(',','.');
            const pStr = document.getElementById('buyPrice').value.replace(',','.');
            
            const w = parseFloat(wStr);
            const p = parseFloat(pStr);
            const t = document.getElementById('type').value;
            const n = document.getElementById('name').value || (t==='gold'?'Gold Position':'Silber Position');

            if (!w || !p) return;

            const items = JSON.parse(localStorage.getItem('db')) || [];
            items.push({ id: Date.now(), t, w, p, n });
            localStorage.setItem('db', JSON.stringify(items));
            
            // Felder leeren
            document.getElementById('weight').value = '';
            document.getElementById('buyPrice').value = '';
            document.getElementById('name').value = '';
            render();
        }

        function render() {
            const items = JSON.parse(localStorage.getItem('db')) || [];
            const list = document.getElementById('list');
            list.innerHTML = '';
            
            let totalVal = 0;
            let totalInvest = 0;

            // Liste umdrehen (neueste oben)
            items.slice().reverse().forEach(i => {
                const currentP = i.t === 'gold' ? prices.gold : prices.silver;
                const val = i.w * currentP;
                const profit = val - i.p;
                
                if(prices.gold > 0) totalVal += val;
                else totalVal += i.p; // Fallback
                
                totalInvest += i.p;

                const div = document.createElement('div');
                div.className = 'card';
                // Layout der einzelnen Zeile (Flexbox)
                div.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center" style="width: 40%;">
                            <div style="font-size: 20px; margin-right: 10px;">
                                ${i.t === 'gold' ? 'üü°' : '‚ö™Ô∏è'}
                            </div>
                            <div style="line-height: 1.2;">
                                <div style="font-size: 14px; color: white;">${i.w}g <span style="color:#666; font-size:12px;">${i.t}</span></div>
                                <div style="font-size: 11px; color: #666;">${i.n}</div>
                            </div>
                        </div>

                        <div class="text-end" style="width: 50%;">
                            <div style="font-size: 15px; font-weight: 600;">${prices.gold > 0 ? val.toFixed(2) : '?'} ‚Ç¨</div>
                            <div class="${profit >= 0 ? 'profit-plus' : 'profit-minus'}">
                                ${profit >= 0 ? '+' : ''}${profit.toFixed(2)} ‚Ç¨
                            </div>
                        </div>

                        <div style="width: 10%; text-align: right;">
                            <span onclick="del(${i.id})" class="delete-x">√ó</span>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });

            // Gesamtwerte oben updaten
            document.getElementById('totalValue').innerText = totalVal.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' ‚Ç¨';
            
            const totalProfit = totalVal - totalInvest;
            if(prices.gold > 0) {
                const profitClass = totalProfit >= 0 ? 'profit-plus' : 'profit-minus';
                const prefix = totalProfit >= 0 ? '+' : '';
                document.getElementById('profitDisplay').innerHTML = `<span class="${profitClass}">${prefix}${totalProfit.toFixed(2)} ‚Ç¨</span>`;
            }
        }

        function del(id) {
            if(!confirm('Eintrag l√∂schen?')) return;
            let items = JSON.parse(localStorage.getItem('db')) || [];
            items = items.filter(i => i.id !== id);
            localStorage.setItem('db', JSON.stringify(items));
            render();
        }

        function wipe() {
            if(confirm('Wirklich ALLES l√∂schen?')) { localStorage.clear(); render(); }
        }

        init();
    </script>
</body>
</html>
