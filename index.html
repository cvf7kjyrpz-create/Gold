<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mein Gold</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        body { background-color: #000000; color: #ffffff; font-family: sans-serif; padding-top: 20px; padding-bottom: 50px; }
        .card { background-color: #1c1c1e; border: 1px solid #333; border-radius: 12px; margin-bottom: 12px; }
        
        .header-box { 
            background: #1c1c1e; border-bottom: 1px solid #333;
            padding: 20px; text-align: center; margin-bottom: 20px; border-radius: 15px;
        }
        
        input, select { 
            background-color: #2c2c2e !important; border: 1px solid #444 !important; color: white !important; height: 45px; border-radius: 8px !important;
        }
        .btn-gold { background: #FFD700; color: black; font-weight: bold; border-radius: 8px; width: 100%; padding: 12px; border: none; }
        
        .val-gold { color: #FFD700; font-weight: bold; }
        .val-silver { color: #A0A0A0; font-weight: bold; }
        .profit-plus { color: #32D74B; }
        .profit-minus { color: #FF453A; }
    </style>
</head>
<body>

    <div class="container">
        
        <div class="header-box">
            <small style="color:#888;">GESAMTWERT</small>
            <h1 id="totalValue" style="margin: 5px 0;">0 €</h1>
            <div id="profitDisplay" style="font-size: 14px;">Lade Preise...</div>
        </div>

        <div class="card p-3">
            <div class="row g-2">
                <div class="col-12">
                    <select id="type" class="form-select">
                        <option value="gold">Gold</option>
                        <option value="silver">Silber</option>
                    </select>
                </div>
                <div class="col-6">
                    <input type="number" id="weight" class="form-control" placeholder="Gramm (g)">
                </div>
                <div class="col-6">
                    <input type="number" id="buyPrice" class="form-control" placeholder="Kaufpreis (€)">
                </div>
                <div class="col-12 mt-2">
                    <input type="text" id="name" class="form-control" placeholder="Name (z.B. Barren)">
                </div>
            </div>
            <button onclick="add()" class="btn-gold mt-3">Hinzufügen</button>
        </div>

        <div id="list" class="mt-4"></div>
        
        <div class="text-center mt-5">
            <button onclick="wipe()" class="btn btn-sm btn-outline-secondary">Reset</button>
        </div>
    </div>

    <script>
        let prices = { gold: 0, silver: 0 };

        async function init() {
            render();
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=pax-gold,kinesis-silver&vs_currencies=eur');
                const data = await res.json();
                prices.gold = data['pax-gold'].eur / 31.1035; 
                prices.silver = data['kinesis-silver'].eur / 31.1035;
                render();
            } catch (e) {
                document.getElementById('profitDisplay').innerText = "Offline Modus";
            }
        }

        function add() {
            const w = parseFloat(document.getElementById('weight').value.replace(',','.'));
            const p = parseFloat(document.getElementById('buyPrice').value.replace(',','.'));
            const t = document.getElementById('type').value;
            const n = document.getElementById('name').value || (t==='gold'?'Gold':'Silber');

            if (!w || !p) return;

            const items = JSON.parse(localStorage.getItem('db')) || [];
            items.push({ id: Date.now(), t, w, p, n });
            localStorage.setItem('db', JSON.stringify(items));
            
            document.getElementById('weight').value = '';
            document.getElementById('buyPrice').value = '';
            render();
        }

        function render() {
            const items = JSON.parse(localStorage.getItem('db')) || [];
            const list = document.getElementById('list');
            list.innerHTML = '';
            
            let totalVal = 0;
            let totalInvest = 0;

            items.reverse().forEach(i => {
                const currentP = i.t === 'gold' ? prices.gold : prices.silver;
                const val = i.w * currentP;
                const profit = val - i.p;
                
                if(prices.gold > 0) totalVal += val;
                else totalVal += i.p;
                
                totalInvest += i.p;

                const div = document.createElement('div');
                div.className = 'card p-3';
                div.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <div class="${i.t === 'gold' ? 'val-gold' : 'val-silver'}">
                                ${i.t === 'gold' ? 'Gold' : 'Silber'} <span style="color:white; font-weight:normal;">${i.w}g</span>
                            </div>
                            <small class="text-muted">${i.n}</small>
                        </div>
                        <div class="text-end">
                            <strong>${prices.gold > 0 ? val.toFixed(2) : '?'} €</strong><br>
                            <small class="${profit >= 0 ? 'profit-plus' : 'profit-minus'}">
                                ${profit >= 0 ? '+' : ''}${profit.toFixed(2)} €
                            </small>
                        </div>
                    </div>
                    <div class="text-end mt-2">
                        <button onclick="del(${i.id})" style="background:none; border:none; color:#FF453A;">Löschen</button>
                    </div>
                `;
                list.appendChild(div);
            });

            document.getElementById('totalValue').innerText = totalVal.toFixed(2) + ' €';
            const totalProfit = totalVal - totalInvest;
            
            if(prices.gold > 0) {
                document.getElementById('profitDisplay').innerHTML = 
                    `Gewinn: <span class="${totalProfit >= 0 ? 'profit-plus' : 'profit-minus'}">${totalProfit >= 0 ? '+' : ''}${totalProfit.toFixed(2)} €</span>`;
            }
        }

        function del(id) {
            let items = JSON.parse(localStorage.getItem('db')) || [];
            items = items.filter(i => i.id !== id);
            localStorage.setItem('db', JSON.stringify(items));
            render();
        }

        function wipe() {
            if(confirm('Alles löschen?')) { localStorage.clear(); render(); }
        }

        init();
    </script>
</body>
</html>
