<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mein Depot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* ERZWINGEN DES DARK MODES */
        html, body {
            background-color: #000000 !important;
            color: #ffffff !important;
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding-bottom: 100px;
            min-height: 100vh;
        }

        /* HEADER BOX */
        .header-box { 
            background: #111111;
            border-bottom: 1px solid #333;
            padding: 20px; 
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }

        /* CARD DESIGN (Die Boxen) */
        .card { 
            background-color: #1c1c1e !important; 
            border: 1px solid #333 !important; 
            border-radius: 12px; 
            margin-bottom: 10px; 
            padding: 12px; 
        }

        /* EINGABEFELDER (Wei√üer Text auf dunklem Grund) */
        input, select { 
            background-color: #2c2c2e !important; 
            border: 1px solid #444 !important; 
            color: #fff !important; 
            border-radius: 8px !important;
            height: 45px !important;
        }
        input::placeholder { color: #888 !important; }
        input:focus, select:focus { border-color: #FFD700 !important; box-shadow: none !important; }

        /* BUTTONS */
        .btn-gold { 
            background: #FFD700; color: #000; font-weight: 800; 
            border: none; border-radius: 8px; width: 100%; height: 45px;
        }
        .refresh-btn {
            font-size: 24px; color: #FFD700; background: none; border: none; padding: 0 10px;
        }

        /* TEXT STYLES */
        .label-small { font-size: 11px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .val-big { font-size: 28px; font-weight: 700; color: white; margin: 5px 0; }
        .val-sub { font-size: 14px; color: #aaa; }
        
        .profit-plus { color: #4cd964; font-weight: bold; }
        .profit-minus { color: #ff3b30; font-weight: bold; }
        
        .item-price-label { font-size: 12px; color: #666; margin-top: 4px; }
    </style>
</head>
<body>

    <div class="header-box">
        <div class="d-flex justify-content-between align-items-start">
            <div>
                <div class="label-small">AKTUELLER WERT</div>
                <div id="totalValue" class="val-big">0,00 ‚Ç¨</div>
                <div id="totalInvest" class="val-sub">Investiert: 0,00 ‚Ç¨</div>
            </div>
            <div class="text-end">
                <button onclick="manualRefresh()" class="refresh-btn" id="refreshBtn">‚Üª</button>
                <div id="profitDisplay" style="margin-top:5px; font-size:15px;">...</div>
            </div>
        </div>
        <div id="statusMsg" style="font-size:11px; color:#555; text-align:center; margin-top:10px;">
            Preise werden geladen...
        </div>
    </div>

    <div class="container mt-3">
        
        <div class="card p-3">
            <h6 style="color:#888; font-size:12px; margin-bottom:10px;">NEUER EINTRAG</h6>
            <div class="row g-2">
                <div class="col-6">
                    <select id="type" class="form-select">
                        <option value="gold">Gold</option>
                        <option value="silver">Silber</option>
                    </select>
                </div>
                <div class="col-6">
                    <input type="number" id="weight" class="form-control" placeholder="Gramm (g)" inputmode="decimal">
                </div>
                <div class="col-6">
                    <input type="number" id="buyPrice" class="form-control" placeholder="Kaufpreis (‚Ç¨)" inputmode="decimal">
                </div>
                <div class="col-6">
                    <input type="text" id="name" class="form-control" placeholder="Name (opt.)">
                </div>
                <div class="col-12 mt-2">
                    <button onclick="add()" class="btn-gold">HINZUF√úGEN</button>
                </div>
            </div>
        </div>

        <div class="label-small mt-4 mb-2 ms-2">DEIN BESTAND</div>
        <div id="list"></div>
        
        <div class="text-center mt-5 mb-5">
            <small onclick="wipe()" style="color:#444; text-decoration:underline; cursor:pointer;">Alles l√∂schen</small>
        </div>
    </div>

    <script>
        let prices = { gold: 0, silver: 0 };

        // Start
        window.onload = function() {
            render();
            fetchPrices();
        };

        // PREISE LADEN
        async function fetchPrices() {
            const status = document.getElementById('statusMsg');
            const btn = document.getElementById('refreshBtn');
            
            try {
                btn.style.transform = "rotate(180deg)";
                status.innerText = "Lade Live-Kurse...";
                
                // Wir nutzen CoinGecko
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=pax-gold,kinesis-silver&vs_currencies=eur&include_last_updated_at=true');
                
                if (!res.ok) throw new Error("Fehler");

                const data = await res.json();
                prices.gold = data['pax-gold'].eur / 31.1035; 
                prices.silver = data['kinesis-silver'].eur / 31.1035;
                
                status.innerText = `Gold: ${prices.gold.toFixed(2)}‚Ç¨/g | Silber: ${prices.silver.toFixed(2)}‚Ç¨/g`;
                status.style.color = "#FFD700";
                
                render(); 
            } catch (e) {
                status.innerText = "Preis-Update fehlgeschlagen (Internet?)";
                status.style.color = "#FF453A";
            } finally {
                btn.style.transform = "none";
            }
        }

        // MANUELLER REFRESH
        function manualRefresh() {
            fetchPrices();
        }

        // HINZUF√úGEN
        function add() {
            // Komma zu Punkt Konvertierung f√ºr iPhone Tastatur
            let wVal = document.getElementById('weight').value.replace(',', '.');
            let pVal = document.getElementById('buyPrice').value.replace(',', '.');
            
            const w = parseFloat(wVal);
            const p = parseFloat(pVal);
            const t = document.getElementById('type').value;
            const n = document.getElementById('name').value || (t==='gold'?'Gold':'Silber');

            if (!w || !p) { alert("Bitte Gewicht und Preis eingeben."); return; }

            const items = JSON.parse(localStorage.getItem('db')) || [];
            items.push({ id: Date.now(), t, w, p, n });
            localStorage.setItem('db', JSON.stringify(items));
            
            // Felder leeren
            document.getElementById('weight').value = '';
            document.getElementById('buyPrice').value = '';
            document.getElementById('name').value = '';
            
            render();
        }

        // ANZEIGEN
        function render() {
            const items = JSON.parse(localStorage.getItem('db')) || [];
            const list = document.getElementById('list');
            list.innerHTML = '';
            
            let totalVal = 0;
            let totalInvest = 0;

            // Neueste zuerst
            items.slice().reverse().forEach(i => {
                const currentP = i.t === 'gold' ? prices.gold : prices.silver;
                
                // Falls Preise 0 sind (offline), nimm Einkaufspreis als Platzhalter f√ºr Wert
                let val = 0;
                if(prices.gold > 0) {
                    val = i.w * currentP;
                } else {
                    val = i.p; // Fallback damit nicht 0 steht
                }

                const profit = val - i.p;
                
                totalVal += val;
                totalInvest += i.p;

                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div style="font-size:22px; margin-right:12px;">${i.t==='gold'?'üü°':'‚ö™Ô∏è'}</div>
                            <div>
                                <div style="font-weight:bold; font-size:16px;">${i.w}g <span style="color:#888; font-weight:normal; font-size:12px;">${i.n}</span></div>
                                <div class="item-price-label">Gekauft f√ºr: ${i.p.toFixed(2)} ‚Ç¨</div>
                            </div>
                        </div>
                        
                        <div class="text-end">
                            <div style="font-weight:bold; font-size:16px;">${prices.gold > 0 ? val.toFixed(2) : '?'} ‚Ç¨</div>
                            <div style="font-size:13px;" class="${profit>=0 ? 'profit-plus':'profit-minus'}">
                                ${profit>=0?'+':''}${profit.toFixed(2)} ‚Ç¨
                            </div>
                        </div>
                    </div>
                    <div class="text-end mt-1">
                        <span onclick="del(${i.id})" style="color:#444; font-size:18px; padding:5px; cursor:pointer;">&times;</span>
                    </div>
                `;
                list.appendChild(card);
            });

            // Header Werte
            document.getElementById('totalValue').innerText = totalVal.toLocaleString('de-DE', {minimumFractionDigits: 2}) + ' ‚Ç¨';
            document.getElementById('totalInvest').innerText = 'Investiert: ' + totalInvest.toLocaleString('de-DE', {minimumFractionDigits: 2}) + ' ‚Ç¨';

            const totalProfit = totalVal - totalInvest;
            const profElem = document.getElementById('profitDisplay');
            
            if(prices.gold > 0) {
                profElem.innerHTML = `<span class="${totalProfit>=0?'profit-plus':'profit-minus'}">Gewinn: ${totalProfit>=0?'+':''}${totalProfit.toFixed(2)} ‚Ç¨</span>`;
            } else {
                profElem.innerText = "Offline";
            }
        }

        // L√ñSCHEN
        function del(id) {
            if(confirm("Eintrag l√∂schen?")) {
                let items = JSON.parse(localStorage.getItem('db')) || [];
                items = items.filter(i => i.id !== id);
                localStorage.setItem('db', JSON.stringify(items));
                render();
            }
        }

        function wipe() {
            if(confirm("ALLES l√∂schen?")) {
                localStorage.clear();
                render();
            }
        }
    </script>
</body>
</html>
