<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mein Depot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        /* Grunddesign: Alles dunkel, Schrift wei√ü */
        body { 
            background-color: #000000; 
            color: #ffffff; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            padding-bottom: 80px; 
        }

        /* Header (Kopfbereich) */
        .header-box { 
            background: linear-gradient(180deg, #1c1c1e 0%, #000000 100%);
            border-bottom: 1px solid #333;
            padding: 15px 20px; 
            position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }

        /* Refresh Button Design */
        .refresh-btn {
            background: none; border: 1px solid #333; 
            color: #FFD700; border-radius: 50%; 
            width: 35px; height: 35px; 
            font-size: 20px; line-height: 33px; text-align: center;
            cursor: pointer; transition: all 0.2s;
        }
        .refresh-btn:active { background-color: #333; transform: scale(0.9); }

        /* Karten Design */
        .card { 
            background-color: #1c1c1e; 
            border: 1px solid #2c2c2e; 
            border-radius: 10px; 
            margin-bottom: 8px; 
            padding: 10px 15px; 
        }
        
        /* WICHTIG: Eingabefelder Lesbarkeit repariert */
        .form-control, .form-select { 
            background-color: #2c2c2e !important; 
            border: 1px solid #3a3a3c !important; 
            color: #ffffff !important; /* Erzwingt wei√üe Schrift */
            font-size: 16px; /* Verhindert Zoom auf iPhone */
            height: 40px; 
            border-radius: 6px !important;
        }
        
        /* Platzhalter Farbe (damit man sieht, was man eingeben muss) */
        ::placeholder { color: #888 !important; opacity: 1; }
        
        /* Fokus Rahmen in Gold */
        .form-control:focus, .form-select:focus { 
            box-shadow: none; border-color: #FFD700 !important; 
        }

        /* Der OK Button */
        .btn-gold { 
            background: linear-gradient(90deg, #FFD700, #FDB931); 
            color: black; font-weight: 700; border-radius: 6px; 
            width: 100%; height: 40px; border: none; font-size: 15px;
        }

        /* Textfarben & Hilfsklassen */
        .val-gold { color: #FFD700; font-weight: bold; }
        .val-silver { color: #e0e0e0; font-weight: bold; } /* Helleres Silber f√ºr Kontrast */
        .profit-plus { color: #32D74B; font-size: 0.9em; font-weight: 500; }
        .profit-minus { color: #FF453A; font-size: 0.9em; font-weight: 500; }
        .small-label { font-size: 10px; text-transform: uppercase; color: #888; letter-spacing: 1px; margin-bottom: 2px; }
        .delete-x { color: #555; font-size: 20px; padding: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <div class="header-box">
        <div>
            <div class="small-label">GESAMTDEPOT</div>
            <div id="totalValue" style="font-size: 26px; font-weight: 700; color: white;">0,00 ‚Ç¨</div>
        </div>
        <div class="text-end d-flex align-items-center gap-3">
            <div>
                <div class="small-label">GEWINN</div>
                <div id="profitDisplay" style="font-size: 16px;">...</div>
            </div>
            <button onclick="manualRefresh()" class="refresh-btn" id="refreshBtn">‚Üª</button>
        </div>
    </div>

    <div class="container mt-3">
        
        <div class="card" style="background: #151515; border-color: #333;">
            <div class="row g-2 align-items-end">
                <div class="col-4">
                    <label class="small-label">METALL</label>
                    <select id="type" class="form-select">
                        <option value="gold">Gold</option>
                        <option value="silver">Silber</option>
                    </select>
                </div>
                <div class="col-4">
                    <label class="small-label">GEWICHT</label>
                    <input type="number" id="weight" class="form-control" placeholder="Gramm" inputmode="decimal">
                </div>
                <div class="col-4">
                    <label class="small-label">PREIS (‚Ç¨)</label>
                    <input type="number" id="buyPrice" class="form-control" placeholder="Euro" inputmode="decimal">
                </div>
                <div class="col-9">
                    <input type="text" id="name" class="form-control" placeholder="Beschreibung (optional)">
                </div>
                <div class="col-3">
                    <button onclick="add()" class="btn-gold">OK</button>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-end mt-4 mb-2 ms-1 me-1">
            <div class="small-label">DEINE POSITIONEN</div>
            <div class="small-label" id="priceInfo">Lade Kurse...</div>
        </div>
        
        <div id="list"></div>
        
        <div class="text-center mt-5">
            <small onclick="wipe()" style="color: #444; cursor:pointer; text-decoration: underline;">Liste komplett l√∂schen</small>
        </div>
    </div>

    <script>
        let prices = { gold: 0, silver: 0 };

        // Starten und Preise laden
        async function init() {
            render(); // Erstmal gespeicherte Daten anzeigen
            await fetchPrices(); // Dann neue Preise holen
        }

        // Preise holen Funktion
        async function fetchPrices() {
            try {
                document.getElementById('priceInfo').innerText = "‚è≥ Aktualisiere...";
                
                // Live Preise abfragen
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=pax-gold,kinesis-silver&vs_currencies=eur');
                const data = await res.json();
                
                prices.gold = data['pax-gold'].eur / 31.1035; 
                prices.silver = data['kinesis-silver'].eur / 31.1035;
                
                document.getElementById('priceInfo').innerText = `Gold: ${prices.gold.toFixed(1)}‚Ç¨/g | Silber: ${prices.silver.toFixed(1)}‚Ç¨/g`;
                render(); // Neu berechnen
                return true;
            } catch (e) {
                document.getElementById('priceInfo').innerText = "‚ö†Ô∏è Offline / Fehler";
                return false;
            }
        }

        // Manueller Refresh Button Klick
        async function manualRefresh() {
            const btn = document.getElementById('refreshBtn');
            btn.innerHTML = '‚è≥'; // Sanduhr zeigen
            await fetchPrices();
            setTimeout(() => { btn.innerHTML = '‚Üª'; }, 500); // Zur√ºck zum Pfeil
        }

        function add() {
            const wStr = document.getElementById('weight').value.replace(',','.');
            const pStr = document.getElementById('buyPrice').value.replace(',','.');
            
            const w = parseFloat(wStr);
            const p = parseFloat(pStr);
            const t = document.getElementById('type').value;
            const n = document.getElementById('name').value || (t==='gold'?'Gold Position':'Silber Position');

            if (!w || !p) return alert("Bitte Gewicht und Preis eingeben");

            const items = JSON.parse(localStorage.getItem('db')) || [];
            items.push({ id: Date.now(), t, w, p, n });
            localStorage.setItem('db', JSON.stringify(items));
            
            // Felder leeren
            document.getElementById('weight').value = '';
            document.getElementById('buyPrice').value = '';
            document.getElementById('name').value = '';
            render();
        }

        function render() {
            const items = JSON.parse(localStorage.getItem('db')) || [];
            const list = document.getElementById('list');
            list.innerHTML = '';
            
            let totalVal = 0;
            let totalInvest = 0;

            items.slice().reverse().forEach(i => {
                const currentP = i.t === 'gold' ? prices.gold : prices.silver;
                const val = i.w * currentP;
                const profit = val - i.p;
                
                if(prices.gold > 0) totalVal += val;
                else totalVal += i.p; 
                
                totalInvest += i.p;

                const div = document.createElement('div');
                div.className = 'card';
                div.innerHTML = `
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center" style="width: 45%;">
                            <div style="font-size: 22px; margin-right: 12px;">
                                ${i.t === 'gold' ? 'üü°' : '‚ö™Ô∏è'}
                            </div>
                            <div style="line-height: 1.2;">
                                <div style="font-size: 15px; color: white; font-weight:500;">${i.w}g <span style="color:#888; font-size:12px;">${i.t==='gold'?'Au':'Ag'}</span></div>
                                <div style="font-size: 12px; color: #888;">${i.n}</div>
                            </div>
                        </div>

                        <div class="text-end" style="width: 45%;">
                            <div style="font-size: 15px; font-weight: 600; color: white;">${prices.gold > 0 ? val.toFixed(2) : '?'} ‚Ç¨</div>
                            <div class="${profit >= 0 ? 'profit-plus' : 'profit-minus'}">
                                ${profit >= 0 ? '+' : ''}${profit.toFixed(2)} ‚Ç¨
                            </div>
                        </div>

                        <div style="width: 10%; text-align: right;">
                            <span onclick="del(${i.id})" class="delete-x">√ó</span>
                        </div>
                    </div>
                `;
                list.appendChild(div);
            });

            // Gesamtwerte oben
            document.getElementById('totalValue').innerText = totalVal.toLocaleString('de-DE', {minimumFractionDigits: 2, maximumFractionDigits: 2}) + ' ‚Ç¨';
            
            const totalProfit = totalVal - totalInvest;
            if(prices.gold > 0) {
                const profitClass = totalProfit >= 0 ? 'profit-plus' : 'profit-minus';
                const prefix = totalProfit >= 0 ? '+' : '';
                document.getElementById('profitDisplay').innerHTML = `<span class="${profitClass}">${prefix}${totalProfit.toFixed(2)} ‚Ç¨</span>`;
            }
        }

        function del(id) {
            if(!confirm('Diesen Eintrag l√∂schen?')) return;
            let items = JSON.parse(localStorage.getItem('db')) || [];
            items = items.filter(i => i.id !== id);
            localStorage.setItem('db', JSON.stringify(items));
            render();
        }

        function wipe() {
            if(confirm('Wirklich alles l√∂schen?')) { localStorage.clear(); render(); }
        }

        init();
    </script>
</body>
</html>
